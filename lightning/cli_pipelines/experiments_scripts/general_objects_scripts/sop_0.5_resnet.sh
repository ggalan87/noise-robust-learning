# Original loss - v0
#python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --config ./configs/common/noise_reduction/no_noise_reduction.yaml --trainer.max_epochs=30 --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl

# SoftTripleLoss v1-4
#python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --config ./configs/common/noise_reduction/no_noise_reduction.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SoftTripleLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl
#python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --config ./configs/common/noise_reduction/gt_noise_reduction.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SoftTripleLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl
#python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --config ./configs/common/noise_reduction/knn_noise_reduction.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SoftTripleLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl
#python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SoftTripleLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --model.init_args.noise_reducer_kwargs="{'strategy': 'torch_metric_learning.noise_reducers.sample_rejection.PRISM', 'keep_only_good_samples': True, 'memory_size': 59551}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl

# SubCenterArcFaceLoss v 5-8
python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --config ./configs/common/noise_reduction/no_noise_reduction.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SubCenterArcFaceLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl
python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --config ./configs/common/noise_reduction/gt_noise_reduction.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SubCenterArcFaceLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl
python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --config ./configs/common/noise_reduction/knn_noise_reduction.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SubCenterArcFaceLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl
python run.py fit --config ./configs/online_products/config_online_products_replicate_alt.yaml --trainer.max_epochs=30 --model.init_args.loss_class=pytorch_metric_learning.losses.SubCenterArcFaceLoss --model.init_args.loss_kwargs="{'optimizer_kwargs': {'lr': 0.003}}" --model.init_args.noise_reducer_kwargs="{'strategy': 'torch_metric_learning.noise_reducers.sample_rejection.PRISM', 'keep_only_good_samples': True, 'memory_size': 59551}" --sampler.init_args.cached_oid_mapping sop_0.5_oid_mapping.pkl

python extract_feats.py --dataset-name OnlineProducts --model-name LitResnet --versions-range 5 8  --epochs-range 0 30 --batch-keys "image" "target" "data_idx" --parts-list "test"
